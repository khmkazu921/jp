<?php

header("Content-type: text/html; charset=utf-8");

$dsn = 'mysql:host=localhost;dbname=form_study;charset=utf8';
$user = 'root';
$password = 'qSJNFXBqw9Z5542D';

try{
	$dbh = new PDO($dsn, $user, $password);
	$item = htmlspecialchars($_POST['item']);
	$sql = "SELECT * FROM " . $item;
	$statement = $dbh -> query($sql);
	$data = $statement->fetchAll(PDO::FETCH_ASSOC);
	$row = $data[0];
	$dbh = null;
} catch (PDOException $e) {
	print('Error:'.$e->getMessage());
	die();
}
?>

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>補足設定</title>
	</head>
	<body>
		
		<?php
		$insert = "INSERT INTO " . $item . " (";
		foreach (array_keys($row) as $val) {
			$insert .= $val . ", ";
		}
		$insert = rtrim($insert, ', ') . ") VALUES (";
		$param = array();
		foreach (array_keys($row) as $val) {
			$post = $_POST[$val];
			$val = ":" . $val;
			$param += array($val => $post);
			$insert .= $val . ", ";
		}
		
		$insert = rtrim($insert, ', ') . ")";//INSERT文完成
		print_r($param);
		echo $insert;
		
		$st = $pdo->prepare($insert);
	echo "あいうえお";
		foreach (array_keys($row) as $val) {
			$post = $_POST[$val];
			$val = ":" . $val;
			$st->bindValue($val, $post); //PDO::PARAM_INT);
		}
	

		$st->execute();
		?>
		<p>登録が完了しました。<br /><a href="setting.php">戻る</a></p>
	</body>
</html>

